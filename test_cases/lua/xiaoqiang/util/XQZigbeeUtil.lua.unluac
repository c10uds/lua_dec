local L0_0
L0_0 = module
L0_0("xiaoqiang.util.XQZigbeeUtil", package.seeall)
L0_0 = require
L0_0 = L0_0("luci.json")
function request_yeelink(A0_1)
  local L1_2, L2_3, L3_4
  L1_2 = require
  L2_3 = "xiaoqiang.util.XQCryptoUtil"
  L1_2 = L1_2(L2_3)
  L2_3 = L1_2.binaryBase64Enc
  L3_4 = A0_1
  L2_3 = L2_3(L3_4)
  L3_4 = _UPVALUE0_
  L3_4 = L3_4.THRIFT_TUNNEL_TO_MIIO
  L3_4 = L3_4 % L2_3
  return _UPVALUE1_.decode(require("luci.util").exec(L3_4))
end
function get_zigbee_count()
  if request_yeelink("{\"command\":\"device_list\"}") == nil or request_yeelink("{\"command\":\"device_list\"}").list == nil then
    return 0
  end
  return #request_yeelink("{\"command\":\"device_list\"}").list
end
function append_yeelink_list(A0_5)
  local L1_6, L2_7, L3_8, L4_9, L5_10, L6_11, L7_12
  L1_6 = request_yeelink
  L1_6 = L1_6(L2_7)
  if L1_6 ~= nil then
  elseif L2_7 == nil or A0_5 == nil then
    return
  end
  for L5_10, L6_11 in L2_7(L3_8) do
    L7_12 = {}
    L7_12.mac = L6_11.mac
    L7_12.type = "zigbee"
    L7_12.ctype = 4
    L7_12.ptype = 3
    L7_12.online = 0
    L7_12.origin_name = L6_11.type
    L7_12.origin_info = L6_11
    if L6_11.type == "light" then
      L7_12.name = "\230\153\186\232\131\189\231\129\175\230\179\161"
      ;({}).icon = "device_list_intelligent_lamp.png"
      ;({}).name = "Yeelink"
    end
    L7_12.company = {}
    if _UPVALUE0_.getDeviceInfoFromDB()[L7_12.mac] ~= nil and not _UPVALUE1_.isStrNil(_UPVALUE0_.getDeviceInfoFromDB()[L7_12.mac].nickname) then
      L7_12.name = _UPVALUE0_.getDeviceInfoFromDB()[L7_12.mac].nickname
    end
    if not _UPVALUE0_.getDeviceInfoFromDB()[L7_12.mac] then
      require("xiaoqiang.util.XQDBUtil").saveDeviceInfo(L7_12.mac, L7_12.origin_name, "", "", "")
    end
    table.insert(A0_5, L7_12)
  end
end
