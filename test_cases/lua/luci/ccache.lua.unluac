local L0_0
L0_0 = require
L0_0 = L0_0("io")
module("luci.ccache")
function cache_ondemand(...)
  if _UPVALUE0_.getinfo(1, "S").source ~= "=?" then
    cache_enable(...)
  end
end
function cache_enable(A0_2, A1_3)
  local L2_4
  A0_2 = A0_2 or "/tmp/luci-modulecache"
  A1_3 = A1_3 or "r--r--r--"
  L2_4 = _UPVALUE0_
  L2_4 = L2_4.loaders
  L2_4 = L2_4[2]
  if not _UPVALUE2_.stat(A0_2) then
    _UPVALUE2_.mkdir(A0_2)
  end
  _UPVALUE0_.loaders[2] = function(A0_5)
    local L1_6, L2_7
    L1_6 = _UPVALUE0_
    L2_7 = "/"
    L1_6 = L1_6 .. L2_7 .. _UPVALUE1_(A0_5)
    L2_7 = _UPVALUE2_
    L2_7 = L2_7(L1_6)
    if L2_7 then
      return L2_7
    end
    L2_7 = _UPVALUE3_(A0_5)
    if _UPVALUE4_(L2_7) == "function" then
      _UPVALUE5_(L1_6, L2_7)
    end
    return L2_7
  end
end
